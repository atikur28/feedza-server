generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  CUSTOMER
  PROVIDER
  ADMIN
}

enum UserStatus {
  ACTIVE
  SUSPENDED
}

enum OrderStatus {
  PLACED
  PREPARING
  READY
  DELIVERED
  CANCELLED
}

model User {
  id          String      @id @default(uuid())
  name        String
  email       String      @unique
  password    String
  role        Role
  status      UserStatus @default(ACTIVE)
  createdAt   DateTime    @default(now())

  providerProfile ProviderProfile?
  orders           Order[]          @relation("CustomerOrders")
  reviews          Review[]
}

model ProviderProfile {
  id          String   @id @default(uuid())
  userId      String   @unique
  restaurantName String
  address     String
  phone       String
  logo        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id])
  meals       Meal[]
  orders      Order[] @relation("ProviderOrders")

  @@index([userId])
  @@map("providers")
}

model Category {
  id        String  @id @default(uuid())
  name      String  @unique
  meals     Meal[]

  @@map("categories")
}

model Meal {
  id          String   @id @default(uuid())
  name        String
  description String
  price       Float
  image       String?
  isAvailable Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  providerId  String
  categoryId  String

  provider   ProviderProfile @relation(fields: [providerId], references: [id])
  category   Category        @relation(fields: [categoryId], references: [id])

  orderItems OrderItem[]
  reviews    Review[]

  @@index([providerId])
  @@map("meals")
}

model Order {
  id            String       @id @default(uuid())
  customerId    String
  providerId    String
  address       String
  totalAmount   Float
  status        OrderStatus @default(PLACED)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime @updatedAt

  customer   User             @relation("CustomerOrders", fields: [customerId], references: [id])
  provider   ProviderProfile  @relation("ProviderOrders", fields: [providerId], references: [id])

  items      OrderItem[]

  @@map("orders")
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId   String
  mealId    String
  quantity  Int
  createdAt DateTime     @default(now())
  updatedAt DateTime @updatedAt

  order   Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
  meal    Meal  @relation(fields: [mealId], references: [id])
}

model Review {
  id        String   @id @default(uuid())
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  mealId   String
  userId   String

  meal     Meal @relation(fields: [mealId], references: [id], onDelete: Cascade)
  user     User @relation(fields: [userId], references: [id])

  @@unique([mealId, userId])
  @@map("reviews")
}